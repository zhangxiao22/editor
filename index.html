<!doctype html>
<html lang="us">

<head>
  <meta charset="utf-8">
  <title>editor</title>
  <link href="external/jqueryui/jquery-ui.css" rel="stylesheet">
  <link href="css/evol-colorpicker.css" rel="stylesheet" />
  <!-- <link href="css/reset.css" rel="stylesheet"> -->
  <style>
    .container {
      display: flex;
      min-height: 100%;
    }

    .component-area {
      flex-basis: 80px;
      background: #ddd;
      padding: 20px 0;
    }

    .component-area li {
      width: 80px;
      height: 80px;
      text-align: center;
      line-height: 80px;
      cursor: pointer;
    }

    .component-area li:hover {
      background: #ccc;
    }

    .edit-area {
      flex-grow: 1;
      background: #fff;
    }

    .custom-editbox {
      width: 20%;
      outline: none;
      position: absolute;
      border: 2px solid #fff;
      
    }
    .editbox-text {height: auto;padding: 5px;}
    .editbox-img {height: 20%;cursor: move;}

    .custom-editbox:hover {
      border: 2px dashed #ddd;
    }

    .custom-editbox.active {
      border: 2px dashed #ddd;
    }

    .custom-editbox.focus {
      border: 2px dashed #00CCFF;
    }

    .custom-editbox .text-area {
      width: 100%;
      /* height: 100%; */
      border: none;
      padding: 0;
      outline: none;
      font-size: 20px;
      cursor: move;
      /* margin: 5px; */
      /* box-sizing: border-box; */
    }
    .custom-editbox.focus .text-area {
      cursor: text;
    }
    .custom-editbox.editbox-text .text-area:empty:before {
      content:'文本';
      color: #bbb;
    }

    .custom-editbox .image-area {
      /* color: #888; */
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-repeat: no-repeat;
      background-size: cover;
    }
    .custom-editbox .image-area .fa-image {
      color: #ddd;
      width: 50%;
      height: 50%;
    }

    .canvas {
      width: 100%;
      height: 100%;
      position: relative;
      background: #fff;
    }

    .tool-area {
      flex-basis: 300px;
      background: #ddd;
    }
    button.active {
      background: red;
    }
  </style>
  <link href="css/common.css" rel="stylesheet">
</head>

<body>
  <div class="container">
    <aside class="component-area">
      <ul>
        <li class="new-text">文本</li>
        <li class="new-image">图片</li>
        <li class="new-video">视频</li>
      </ul>
    </aside>
    <section class="edit-area">
      <div class="canvas"></div>
    </section>
    <aside class="tool-area">
      <div class="tools"></div>
      <button class="save">save</button>
      <!-- <div class="demoPanel ui-widget ui-widget-content ui-corner-all" style="width:130px"> -->
        
        <!-- <input id="cpBoth" value="#b7dde8" /> -->
        
      <!-- </div> -->
    </aside>
  </div>
  <script src="external/jquery/jquery.js"></script>
  <script src="external/jqueryui/jquery-ui.min.js"></script>
  <script defer src="external/fontawesome/fontawesome-all.js"></script>
  <script src="js/evol-colorpicker.js" type="text/javascript"></script>


  <script src="js/common.js"></script>
  <script src="js/editBox.js"></script>
  <script src="js/textBox.js"></script>
  <script src="js/imgBox.js"></script>
  <script>
    $(function () {

      $('.new-text').click(function (e) {
        e.stopPropagation();
        $('<div>').appendTo('.canvas').textbox();
      });
      $('.new-image').click(function (e) {
        e.stopPropagation();
        $('<div>').appendTo('.canvas').imgbox();
      });
      // $('.new-video').click(function() {
      //   let box = $('<div>').appendTo('.canvas').textarea();
      // })
      $(document).on('click', '.component-area,.edit-area', function () {
        $('.editbox-text').textbox('blur');
        $('.editbox-img').imgbox('blur');
      });

      $('.save').click(function () {
        
        $('.editbox-text').textbox('blur');
        $('.editbox-img').imgbox('blur');

        let w = $('.canvas').width();
        let h = $('.canvas').height();
        let attribute_x = ['width', 'right', 'left'];
        let attribute_y = ['height', 'top', 'bottom'];
        $('.custom-editbox').each(function () {
          $(this).editbox('getOptions');
          let obj = {};
          attribute_x.forEach(i => {
            obj[i] = parseInt($(this).css(i)) * 100 / w + '%';
          });
          attribute_y.forEach(i => {
            // console.log($(this).css(i));
            obj[i] = parseInt($(this).css(i)) * 100 / h + '%';
          });
          // console.log(obj);
          $(this).css(obj);
        });
        // }
        console.log($('.canvas').html());
        localStorage.setItem("tempHtml",$('.canvas').html());
        window.open('view.html');
      });
    });
  </script>
</body>

</html>